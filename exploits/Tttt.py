#!/usr/bin/env python
import asyncio
import aiohttp
import re

from farm.exploits import AbstractExploit


class Tttt(AbstractExploit):
    async def attack(self, hostname):
        async with aiohttp.ClientSession() as session:
            async with session.get('https://en.wikipedia.org/wiki/Cat') as resp:
                print(resp.status)
                text = await resp.text()

                current_word = ''
                find_count = 0
                for i in text:
                    if i == 'c' and current_word == '' or \
                       i == 'a' and current_word == 'c' or \
                       i == 't' and current_word == 'ca':
                            current_word += i
                            continue
                    elif current_word == 'cat':
                        find_count += 1
                    current_word = ''

                re_count = re.findall(r'cat', text)
                print('Cat farm: find_count: ' + str(find_count) + ', re_count: ' + str(len(re_count)))

        return find_count
